---
layout: post
title:  "配置使用数据视图"
date:   2020-05-26
visible: 1
---

数据视图用于以不同的方式展示数据。Ebaas平台会自动为数据模型中的每个数据类创建两个数据视图：

* 默认视图：包含数据类中所有用途为“Included”的属性，无过滤条件；
* 详细视图：包含数据类中所有属性 （Included和Exceluded），无过滤条件；

前面的教程我们使用SiteMapStduio配置的“事务管理”菜单，采用的是“app.smarttables.datagrid”的表格模块。如果没有指定任何数据视图的话，二维表格模块会自动使用默认视图。

在某些应用场景下，我们可能需要特殊的数据视图。例如，用户可能希望有一个二维表格只显示“处理人”为自己而且事务不处于关闭状态的事务实例，称为“我的事务”。这样就不需要在所有的“事务”中搜索与自己相关的事务了。这个需求可以通过定义特殊数据视图来实现。下面我们介绍具体步骤。

#### 创建“我的事务”数据视图

创建数据视图需要使用DesignStudio工具。

* 打开DesignStudio工具 => 以admin用户登录到“事务跟踪管理”数据库；
* 在左边导航栏选择“数据视图”节点 => 右键菜单选择“创建...”；
* 在弹出的“添加新客体”窗口中 => 输入名称：MyIssues => 输入显示名：我的事务 => 确认。见下图：

<img src="{{'/assets/img/2018-2-26-创建数据视图.png' | prepend: site.baseurl }}" alt="">

* 打开数据视图配置向导的第一步；
* 在这一步，选择数据类为“事务”；
* 点击“下一步”；

<img src="{{'/assets/img/2018-2-26-数据视图向导第一步.png' | prepend: site.baseurl }}" alt="">

* 向导第二步定义视图的查询表达式；
* 按照下图定义查询表达式，表示选择“处理人”为当前登录用户且状态不等于“关闭”的事务数据实例；
* 点击“下一步”；

<img src="{{'/assets/img/2018-2-26-数据视图向导第二步.png' | prepend: site.baseurl }}" alt="">

值得注意的是，currentUser()为系统内置函数，返回当前登录用户名，输入时一定要包含英文的括号，如下图：

<img src="{{'/assets/img/2018-2-26-数据视图向导定义表达式.png' | prepend: site.baseurl }}" alt="">

* 向导的第三步定义数据视图所包含的结果属性；
* 点击“添加”按键，从弹出的属性列表中选择要包含的属性及排列顺序；
* 点击“完成”按键，结束数据视图的创建；

<img src="{{'/assets/img/2018-2-26-数据视图向导第三步.png' | prepend: site.baseurl }}" alt="">

* 点击“文件” => “保存到数据库” => 确认保存数据模型；

#### 配置“我的事务”菜单

* 打开SiteMapStudio工具 => 登录为admin用户；
* 选择“事务跟踪管理”网站地图下的“菜单栏” => 右键菜单选择“添加...”;
* 在弹出的“添加新项”窗口中，输入名称：MyIssues => 确认；

<img src="{{'/assets/img/2018-2-26-创建我的事务菜单.png' | prepend: site.baseurl }}" alt="">

* 选择“菜单栏”下新创建的“MyIssues”菜单 => 在右边“设置”里做如下参数设置；

| 设置参数名 | 设置参数值 | 描述 |
|-------|--------|---------|
| 名称 | MyIssues | 菜单的名称，必须是唯一的 |
| 显示名 | 我的事务 | 菜单在用户界面显示的名称 |
| 模块URL | app.smarttables.datagrid | 菜单使用的界面模块，该模块是二维表格模块 |
| 数据库 | 事务跟踪管理 1.0 | 该菜单指向的数据库 |
| 数据类 | 事务 | 该菜单指向的数据类 |
| 图标名称 | fa fa-fw fa-search-plus | 指定菜单的图标，可选项 |
| 描述 | col-xs-4 col-sm-3 col-md-2 page-darkred | 指定菜单的显示样式 |

点击“模块参数”右边“...”按钮 => 在弹出的“定义参数”框中按照下表设置参数：

| 设置参数名 | 设置参数值 | 描述 |
|-------|--------|---------|
| dataView | MyIssues | 使用的数据视图英文名 |

* 选择“我的事务”菜单，使用右键将该菜单上移到“事务管理”菜单前面；

菜单的配置结果如下图所示：

<img src="{{'/assets/img/2018-2-26-配置我的事务菜单.png' | prepend: site.baseurl }}" alt="">

保存网站地图。

{% include important.html content="重启Ebaas服务器" %}

#### 测试“我的事务”菜单

* 使用推荐的浏览器访问： http://localhost:8080；
* 登录为用户demo2（密码：888），可以看到“我的事务”菜单出现，如下图所示:

<img src="{{'/assets/img/2018-2-26-测试我的事务菜单.png' | prepend: site.baseurl }}" alt="">

点击“我的事务”菜单进入二维表格界面，可以看到二维表格子显示处理人为“吴敏”（demo2用户的显示名）的事务实例。如下图所示：

<img src="{{'/assets/img/2018-2-26-使用我的事务菜单.png' | prepend: site.baseurl }}" alt="">

#### 修改数据视图

如果需要对数据视图进行修改的话，使用DesignStudio登录数据库，在左边的导航栏中的“数据视图”下选择要修改的数据视图，右键菜单选择修改，会弹出数据视图向导进行修改（如下图）。修改后要保存到数据库。

<img src="{{'/assets/img/2018-2-26-修改数据视图.png' | prepend: site.baseurl }}" alt="">

以上内容介绍了配置和使用数据视图的步骤。




