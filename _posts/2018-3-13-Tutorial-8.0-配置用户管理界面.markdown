---
layout: post
title:  "配置用户管理界面"
date:   2020-05-13
visible: 1
---

在前面的教程中，我们使用系统预先创建的用户（例如，demo1, demo2,demo3等），角色（系统管理员和经理等）和部门（例如：实验中心和产品试验部门等）进行登录或设置权限规则。当您使用Ebaas构建企业应用时，则需要根据企业的情况在系统中创建用户，角色及部门。Ebaas平台提供了针对用户，角色和组织结构管理的功能，能满足企业应用的需要。下面，我们就逐一介绍这些功能。

Ebaas平台将用户，角色和部门信息，以及用户与角色或部门的关系保存在自带的“UserInfo”数据库中。由于企业应用软件通常涉及安全保密的需求，通常由指定的系统管理员负责用户信息的维护。您可以打开DesignStudio客户端，然后“工具” => “创建用户/角色”打开对话框对用户信息进行添加，修改，删除，以及赋予角色等操作，如下图所示。

<img src="{{'/assets/img/2018-3-13-DesignStudio用户角色管理.png' | prepend: site.baseurl }}" alt="">

为了方便系统管理员使用浏览器进行用户信息的管理，Ebaas平台提供了基于Web的用户及角色管理模块。我们这里主要介绍基于Web的用户信息管理功能。

#### 配置用户目录模块菜单

首先，我们介绍如何配置基于Web的用户管理模块。步骤如下：

* 从“开始” => Ebaas => SiteMapStudio打开SiteMapStudio工具；
* 点击“文件” => “打开” => 以admin登录；
* 选择“事务跟踪管理”网站地图 => 选择“系统设置”菜单项 => 右键菜单选择“添加”；
* 在弹出的“添加新项”对话框中 => 输入名称“UserDirectory” => 确认。 如下图所示；

<img src="{{'/assets/img/2018-3-13-创建用户目录菜单.png' | prepend: site.baseurl }}" alt="">

* 展开“系统设置”菜单 => 选择新添加的“UserDirectory”菜单，在“设置”选项卡中按照下表的参数进行设置：

| 设置参数名 | 设置参数值 | 描述 |
|-------|--------|---------|
| 名称 | UserDirectory | 菜单项的名称，必须是唯一的 |
| 显示名 | 用户目录 | 菜单项在用户界面显示的名称 |
| 数据库 | USERINFO 1.0 | 菜单项所指向的数据库 |
| 数据类 | User | 菜单项所指向的数据类 |
| 模块URL | app.userdirectory | 菜单指向的界面模块，该模块是用户目录管理模块 |
| 图标名称 | fa fa-fw fa-male | 菜单显示的图标 |
| 描述 | col-xs-4 col-sm-3 col-md-2 page-purple | 菜单显示的样式 |

点击“模块参数”右边“...”按钮 => 在弹出的“定义参数”框中按照下表设置参数：

| 设置参数名 | 设置参数值 | 描述 |
|-------|--------|---------|
| formTemplate | userform.htm | 指定添加或修改用户信息的表单模板（系统自带） |
| dataView | usercn | 指定显示用户列表的数据视图（系统自带） |

菜单的配置结果如下图所示：

<img src="{{'/assets/img/2018-3-13-设置用户目录菜单.png' | prepend: site.baseurl }}" alt="">

#### 配置用户目录定制命令组

我们可以为用户目录模块配置两个定制命令，一个指定用户所属角色，另一个指定用户所属部门。

首先，我们需要在“定制命令栏”下创建“用户定制命令组”，步骤如下：

* 选择“事务跟踪管理”网站地图下的“定制命令栏”项 => 右键菜单选择“添加”；
* 在弹出的“添加新项”对话框中 => 输入名称“UserCommands” => 确认。 如下图所示；

<img src="{{'/assets/img/2018-3-13-创建用户命令组.png' | prepend: site.baseurl }}" alt="">

* 选择“定制命令栏”下新添加的“UserCommands”菜单，在“设置”选项卡中按照下表的参数进行设置：

| 设置参数名 | 设置参数值 | 描述 |
|-------|--------|---------|
| 名称 | UserCommands | 定制命令的名称 |
| 显示名 | 用户目录命令组 | 显示的名称 |
| 数据库 | USERINFO 1.0 | 命令组所指向的数据库 |
| 数据类 | User | 命令组所指向的数据类 |

配置结果如下图所示：

<img src="{{'/assets/img/2018-3-13-配置用户命令组.png' | prepend: site.baseurl }}" alt="">

#### 配置指定角色定制命令

* 选择“用户目录命令组”项 => 右键菜单选择“添加”；
* 在弹出的“添加新项”对话框中 => 输入名称“AssignFunctions” => 确认。 如下图所示；

<img src="{{'/assets/img/2018-3-13-创建指定角色命令.png' | prepend: site.baseurl }}" alt="">

* 选择“用户命令组”下新添加的“AssignFunctions”菜单，在“设置”选项卡中按照下表的参数进行设置：

| 设置参数名 | 设置参数值 | 描述 |
|-------|--------|---------|
| 名称 | AssignFunctions | 定制命令的名称 |
| 显示名 | 指定角色 | 定制命令在界面显示名称 |
| 模块URL | .assignroles | 定制命令指向的界面模块，该模块是指定用户所属角色的模块 |
| 图标名称 | fa fa-lg fa-tags | 定制命令显示的图标 |

点击“模块参数”右边“...”按钮 => 在弹出的“定义参数”框中按照下表设置参数：

| 设置参数名 | 设置参数值 | 描述 |
|-------|--------|---------|
| roletype | Function | 表示指定角色 |
| dataview | rolecn | 指定显示角色列表的数据视图（系统自带） |

配置结果如下图所示：

<img src="{{'/assets/img/2018-3-13-配置指定角色命令.png' | prepend: site.baseurl }}" alt="">

#### 配置指定部门定制命令

* 选择“用户目录命令组”项 => 右键菜单选择“添加”；
* 在弹出的“添加新项”对话框中 => 输入名称“AssignUnits” => 确认。 如下图所示；

<img src="{{'/assets/img/2018-3-13-创建指定部门命令.png' | prepend: site.baseurl }}" alt="">

* 选择“用户命令组”下新添加的“AssignUnits”菜单，在“设置”选项卡中按照下表的参数进行设置：

| 设置参数名 | 设置参数值 | 描述 |
|-------|--------|---------|
| 名称 | AssignUnits | 定制命令的名称 |
| 显示名 | 指定部门 | 定制命令在界面显示名称 |
| 模块URL | .assignroles | 定制命令指向的界面模块，该模块是指定用户所属角色的模块 |
| 图标名称 | fa fa-lg fa-building | 定制命令显示的图标 |

点击“模块参数”右边“...”按钮 => 在弹出的“定义参数”框中按照下表设置参数：

| 设置参数名 | 设置参数值 | 描述 |
|-------|--------|---------|
| roletype | Unit | 表示指定部门 |
| dataview | unitcn | 指定显示部门列表的数据视图（系统自带） |

配置结果如下图所示：

<img src="{{'/assets/img/2018-3-13-配置指定部门命令.png' | prepend: site.baseurl }}" alt="">

保存网站地图。

{% include important.html content="重启Ebaas服务器" %}

#### 测试用户目录菜单

* 使用推荐的浏览器访问： http://localhost:8080；
* 登录为用户demo1（密码：888）。由于demo1用户属于“系统管理员”角色，登入进去后，在导航栏会显示“系统设置”菜单，而且在首页会显示“用户目录”菜单项，如下图所示:

<img src="{{'/assets/img/2018-3-13-测试用户目录菜单显示.png' | prepend: site.baseurl }}" alt="">

点击“用户目录”菜单进入用户管理界面，可以进行添加用户，修改用户信息，指定用户角色及部门，或者删除用户的操作。如下图所示：

<img src="{{'/assets/img/2018-3-13-用户管理界面.png' | prepend: site.baseurl }}" alt="">

点击demo2记录下的“指定角色”命令，可以看到demo2属于“实验室经理”角色。

<img src="{{'/assets/img/2018-3-13-指定用户角色窗口.png' | prepend: site.baseurl }}" alt="">

点击demo2记录下的“指定部门”命令，可以看到demo2属于多个试验测试组。

<img src="{{'/assets/img/2018-3-13-指定用户部门窗口.png' | prepend: site.baseurl }}" alt="">

点击右上角的“添加”按键，弹出添加用户的表单，可以添加新的用户。见下图：

<img src="{{'/assets/img/2018-3-13-添加用户窗口.png' | prepend: site.baseurl }}" alt="">

添加新用户时，可以填写初始密码。新用户登录后可以自行修改密码。修改密码的界面如下图所示：

<img src="{{'/assets/img/2018-3-13-修改用户密码.png' | prepend: site.baseurl }}" alt="">

至此，我们配置完成用于用户管理的Web操作界面。

