---
layout: post
title:  "配置表单条件校验"
date:   2020-05-02
visible: 1
---

在前面创建数据类属性时，我们通过对属性的“是否必要”设置，范围约束和表达式约束等设置，使得表单引擎能对提交的数据进行校验。

但是在许多应用场景中，有些校验规则是基于条件的。例如，在“事务”数据类中，“处理人”属性的“是否必要”设置为false，表示非必填属性。但是当“状态”属性值为“已指定”时，“处理人”属性就变为必填。同样，“关闭日期”属性值在“状态”属性值为“关闭”时必须填写。

这类要求我们称之为条件校验。您可在数据模型中配置来实现这类条件校验的规则。

#### 设置条件校验规则

* 从“开始”菜单 => Ebaas => DesignStudio,打开DesignStudio；
* 从DesignStudio的“文件”菜单项 => “打开” => “数据库”打开“连接数据库”弹窗；
* 从数据库列表中选择“事务跟踪管理”数据库，并以管理员用户名“admin”和密码“admin”登录;
* 在左边导航栏中选择“事务”数据类节点，然后在右下方切换到“校验规则”选项卡 （见下图）。

<img src="{{'/assets/img/2018-3-2-校验规则设置.png' | prepend: site.baseurl }}" alt="">

* 点击下方的“添加”按键 => 弹出“定义校验规则”窗口。
* 点击“IF”参数右边的“...” => 弹出“定义布尔表单式” => 定义表达式如下图所示，表示当“状态”等于“已指定”并且“处理人”为空 => 确认；

<img src="{{'/assets/img/2018-3-2-校验规则条件设置.png' | prepend: site.baseurl }}" alt="">

* 点击“THEN”左边的向下三角展开 => 在“错误信息”右边输入：请指定处理人。（见下图）

<img src="{{'/assets/img/2018-3-2-校验规则错误信息设置.png' | prepend: site.baseurl }}" alt="">

{% include note.html content="错误信息可以任意填写，用于界面显示。" %}

* 点击确认。完成了一条校验规则的定义。校验规则可以根据需要定义多条；
* 保存数据模型到数据库；

#### 测试条件校验

* 使用浏览器登录到Web界面，单击首页的“事务管理”图标，进入“事务”数据表格页面，单击某条“处理人”为“未知”的数据实例，在下拉的工具栏中；
* 单击“编辑”命令图标打开“事务”表单进行编辑；
* 将“状态”的值更改为“已指定” => 点击“提交”，将会显示错误信息“请指定处理人”。如下图：

<img src="{{'/assets/img/2018-3-2-校验规则web校验.png' | prepend: site.baseurl }}" alt="">

在后续教程我们还会介绍如表单的其它高级功能，比如配置表单的级联属性，跨数据类表单和内嵌关联数据的二维表格等。

